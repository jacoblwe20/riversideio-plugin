/*! riversideio-plugin.js - 0.0.1 - 2013-06-03 - scottmotte */
!function(a){var b=function(){return this instanceof b?(this.endpoint="https://victoria-club.herokuapp.com/api/v0",this.script=this.CurrentlyExecutedScript(),this.user_id=null,this.session_token=null,this.init(),this):new b};b.prototype.init=function(){this.script?(this.script.className+=" riversideio-script",this.draw(),this.events()):console.error("Could not find script tag to initialize on.")},a.RiversideioPlugin=b}(this),function(a){a.prototype.draw=function(){this._drawSignupForm(),this._drawLoginForm(),this._drawCCForm()},a.prototype._drawSignupForm=function(){return this.signup_form=document.createElement("form"),this.signup_form.className="riversideio-signup-form",this.signup_form.method="POST",this.signup_form.action="#",this.email_field=document.createElement("input"),this.email_field.className="riversideio-email-field",this.email_field.type="email",this.email_field.placeholder="Email",this.email_field.setAttribute("required",""),this.signup_form.appendChild(this.email_field),this.password_field=document.createElement("input"),this.password_field.className="riversideio-password-field",this.password_field.type="password",this.password_field.placeholder="Password",this.password_field.setAttribute("required",""),this.signup_form.appendChild(this.password_field),this.signup_btn=document.createElement("input"),this.signup_btn.className="riversideio-signup-btn",this.signup_btn.type="submit",this.signup_btn.value="Join",this.signup_form.appendChild(this.signup_btn),this.InsertAfter(this.script,this.signup_form)},a.prototype._drawLoginForm=function(){return this.login_form=document.createElement("form"),this.login_form.className="riversideio-login-form",this.login_form.method="POST",this.login_form.action="#",this.login_form.email_field=document.createElement("input"),this.login_form.email_field.className="riversideio-login-email-field",this.login_form.email_field.type="email",this.login_form.email_field.placeholder="Email",this.login_form.email_field.setAttribute("required",""),this.login_form.appendChild(this.login_form.email_field),this.login_form.password_field=document.createElement("input"),this.login_form.password_field.className="riversideio-login-password-field",this.login_form.password_field.type="password",this.login_form.password_field.placeholder="Password",this.login_form.password_field.setAttribute("required",""),this.login_form.appendChild(this.login_form.password_field),this.login_form.login_btn=document.createElement("input"),this.login_form.login_btn.className="riversideio-login-btn",this.login_form.login_btn.type="submit",this.login_form.login_btn.value="Login",this.login_form.appendChild(this.login_form.login_btn),this.InsertAfter(this.script,this.login_form)},a.prototype._drawCCForm=function(){return this.cc_form=document.createElement("form"),this.cc_form.className="riversideio-cc-form",this.cc_form.method="PUT",this.cc_form.action="#",this.card_number_field=document.createElement("input"),this.card_number_field.className="riversideio-card-number-field",this.card_number_field.type="text",this.card_number_field.placeholder="Card Number",this.card_number_field.setAttribute("required",""),this.cc_form.appendChild(this.card_number_field),this.card_exp_month_field=document.createElement("input"),this.card_exp_month_field.className="riversideio-card-exp-month-field",this.card_exp_month_field.type="text",this.card_exp_month_field.placeholder="MM",this.card_exp_month_field.setAttribute("required",""),this.cc_form.appendChild(this.card_exp_month_field),this.card_exp_year_field=document.createElement("input"),this.card_exp_year_field.className="riversideio-card-exp-year-field",this.card_exp_year_field.type="text",this.card_exp_year_field.placeholder="YY",this.card_exp_year_field.setAttribute("required",""),this.cc_form.appendChild(this.card_exp_year_field),this.card_cvc_field=document.createElement("input"),this.card_cvc_field.className="riversideio-card-cvc-field",this.card_cvc_field.type="text",this.card_cvc_field.placeholder="CVC",this.card_cvc_field.setAttribute("required",""),this.cc_form.appendChild(this.card_cvc_field),this.cc_btn=document.createElement("input"),this.cc_btn.className="riversideio-cc-btn",this.cc_btn.type="submit",this.cc_btn.value="Submit",this.cc_form.appendChild(this.cc_btn),this.InsertAfter(this.script,this.cc_form)}}(RiversideioPlugin),function(a){var b,c="click",d="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch?!0:!1;d&&(c="touchend"),a.prototype.events=function(){b=this,this.signup_form.addEventListener("submit",this.submitSignupForm,!1),this.login_form.addEventListener("submit",this.submitLoginForm,!1),this.cc_form.addEventListener("submit",this.submitCCForm,!1)},a.prototype.submitSignupForm=function(a){a&&a.preventDefault();var c={email:b.email_field.value,password:b.password_field.value};b.Post(b.endpoint+"/users.json",c,function(a){a.success?(b.session_token=a.user.session_token,alert("implement")):alert(a.error.message)})},a.prototype.submitLoginForm=function(a){a&&a.preventDefault();var c={email:b.login_form.email_field.value,password:b.login_form.password_field.value};b.Post(b.endpoint+"/sessions.json",c,function(a){a.success?(b.user_id=a.id,b.session_token=a.session_token):alert(a.error.message)})},a.prototype.submitCCForm=function(a){a&&a.preventDefault();var c={session_token:b.session_token,card_number:b.card_number_field.value,card_cvc:b.card_cvc_field.value,card_exp_month:b.card_exp_month_field.value,card_exp_year:b.card_exp_year_field.value};b.Post(b.endpoint+"/users/"+b.user_id+"/update_card.json",c,function(a){a.success?alert("implement"):alert(a.error.message)})}}(RiversideioPlugin),function(a){a.prototype.Uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b,c;return b=0|16*Math.random(),c="x"===a?b:8|3&b,c.toString(16)})},a.prototype.CurrentlyExecutedScript=function(){var a;if(document){var b=document.getElementsByTagName("script");a=b[b.length-1]}return a},a.prototype.InsertAfter=function(a,b){return a.parentNode.insertBefore(b,a.nextSibling)},a.prototype.StandardScreen=function(){return document.body.clientWidth>=580},a.prototype.FireEvent=function(a,b,c){var d=!0,e=!0,f=document.createEvent("Events");f.initEvent(a,d,e),f.data=c,b.dispatchEvent(f)},a.prototype.Encode64=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(l="",j=0,a=unescape(encodeURIComponent(a));j<a.length;){if(c=a.charCodeAt(j++)||0,d=a.charCodeAt(j++)||0,e=a.charCodeAt(j++)||0,k=Math.max(c,d,e),k>255)throw k+" is an invalid BASE64 character";for(f=c>>2,g=(3&c)<<4|d>>4,h=(15&d)<<2|e>>6,i=63&e,isNaN(d)?h=i=64:isNaN(e)&&(i=64),o=[f,g,h,i],m=0,n=o.length;n>m;m++)b=o[m],l+=p.charAt(b)}return l},a.prototype.Post=function(a,b,c){var d=new XMLHttpRequest;if(d.open("post",a,!0),b.key){var e=this.Encode64(b.key);delete b.key,d.setRequestHeader("Authorization","Basic "+e)}d.setRequestHeader("Content-type","application/json"),d.onreadystatechange=function(){4==d.readyState&&(200==d.status?c(JSON.parse(d.responseText)):console.error("You found an ajax error. Contact us at Riverside.io with any information you have, and we will fix it."))},d.send(JSON.stringify(b))},a.prototype.postSignature=function(a){self=this;var b={data_url:a,key:self.key};self.Post(self.endpoint+"/api/v0/signatures.json",b,function(a){a.success?(self.hidden_field.value=a.signature.url,self.FireEvent("signature_pad:save",self.script,a.signature)):console.error(a.error.message)})}}(RiversideioPlugin);var riversideio_plugin=RiversideioPlugin();